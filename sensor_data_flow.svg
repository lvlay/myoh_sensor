<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1000" height="1000" xmlns="http://www.w3.org/2000/svg">
  <!-- 背景 -->
  <rect width="1000" height="1000" fill="#f8f9fa" />
  
  <!-- 标题 -->
  <text x="500" y="40" font-family="Arial, sans-serif" font-size="24" text-anchor="middle" font-weight="bold" fill="#333">传感器子系统数据流向图</text>
  
  <!-- 左侧：客户端请求流程 -->
  <text x="250" y="80" font-family="Arial, sans-serif" font-size="18" text-anchor="middle" font-weight="bold" fill="#0d47a1">客户端请求流程</text>
  
  <!-- 右侧：传感器数据回传流程 -->
  <text x="750" y="80" font-family="Arial, sans-serif" font-size="18" text-anchor="middle" font-weight="bold" fill="#b71c1c">传感器数据回传流程</text>
  
  <!-- 客户端区域 -->
  <rect x="50" y="100" width="400" height="800" rx="10" ry="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" />
  <text x="250" y="130" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" font-weight="bold" fill="#0d47a1">客户端 (Client)</text>
  
  <!-- 服务端区域 -->
  <rect x="550" y="100" width="400" height="800" rx="10" ry="10" fill="#fff3e0" stroke="#ff9800" stroke-width="2" />
  <text x="750" y="130" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" font-weight="bold" fill="#e65100">服务端 (Server)</text>
  
  <!-- 客户端组件 -->
  <!-- 应用程序 -->
  <rect x="100" y="160" width="300" height="60" rx="5" ry="5" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="250" y="195" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">应用程序 (Application)</text>
  
  <!-- SensorAgentProxy -->
  <rect x="100" y="260" width="300" height="60" rx="5" ry="5" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="250" y="295" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorAgentProxy</text>
  
  <!-- SensorServiceClient -->
  <rect x="100" y="360" width="300" height="60" rx="5" ry="5" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="250" y="395" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorServiceClient</text>
  
  <!-- SensorServiceProxy -->
  <rect x="100" y="460" width="300" height="60" rx="5" ry="5" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="250" y="495" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorServiceProxy</text>
  
  <!-- SensorClientStub -->
  <rect x="100" y="660" width="300" height="60" rx="5" ry="5" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="250" y="695" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorClientStub</text>
  
  <!-- 数据通道 -->
  <rect x="100" y="760" width="300" height="60" rx="5" ry="5" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="250" y="795" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorDataChannel</text>
  
  <!-- 服务端组件 -->
  <!-- SensorServiceStub -->
  <rect x="600" y="460" width="300" height="60" rx="5" ry="5" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="750" y="495" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorServiceStub</text>
  
  <!-- SensorService -->
  <rect x="600" y="560" width="300" height="60" rx="5" ry="5" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="750" y="595" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorService</text>
  
  <!-- SensorClientProxy -->
  <rect x="600" y="660" width="300" height="60" rx="5" ry="5" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="750" y="695" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">SensorClientProxy</text>
  
  <!-- HDI层 -->
  <rect x="600" y="760" width="300" height="60" rx="5" ry="5" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="750" y="795" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">HDI层 (HdiConnection)</text>
  
  <!-- 硬件层 -->
  <rect x="600" y="860" width="300" height="60" rx="5" ry="5" fill="#e0e0e0" stroke="#9e9e9e" stroke-width="1" />
  <text x="750" y="895" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">传感器硬件 (Sensor Hardware)</text>
  
  <!-- 客户端请求流程箭头 -->
  <!-- 应用程序 -> SensorAgentProxy -->
  <line x1="250" y1="220" x2="250" y2="260" stroke="#0d47a1" stroke-width="2" />
  <polygon points="245,260 250,270 255,260" fill="#0d47a1" />
  <text x="260" y="240" font-family="Arial, sans-serif" font-size="12" fill="#0d47a1">1. 调用API</text>
  
  <!-- SensorAgentProxy -> SensorServiceClient -->
  <line x1="250" y1="320" x2="250" y2="360" stroke="#0d47a1" stroke-width="2" />
  <polygon points="245,360 250,370 255,360" fill="#0d47a1" />
  <text x="260" y="340" font-family="Arial, sans-serif" font-size="12" fill="#0d47a1">2. 转发请求</text>
  
  <!-- SensorServiceClient -> SensorServiceProxy -->
  <line x1="250" y1="420" x2="250" y2="460" stroke="#0d47a1" stroke-width="2" />
  <polygon points="245,460 250,470 255,460" fill="#0d47a1" />
  <text x="260" y="440" font-family="Arial, sans-serif" font-size="12" fill="#0d47a1">3. 调用代理</text>
  
  <!-- SensorServiceProxy -> SensorServiceStub (IPC) -->
  <line x1="400" y1="490" x2="600" y2="490" stroke="#0d47a1" stroke-width="2" />
  <polygon points="595,485 605,490 595,495" fill="#0d47a1" />
  <text x="500" y="480" font-family="Arial, sans-serif" font-size="12" fill="#0d47a1">4. IPC请求</text>
  
  <!-- SensorServiceStub -> SensorService -->
  <line x1="750" y1="520" x2="750" y2="560" stroke="#0d47a1" stroke-width="2" />
  <polygon points="745,560 750,570 755,560" fill="#0d47a1" />
  <text x="760" y="540" font-family="Arial, sans-serif" font-size="12" fill="#0d47a1">5. 分发请求</text>
  
  <!-- SensorService -> HDI层 -->
  <line x1="750" y1="620" x2="750" y2="760" stroke="#0d47a1" stroke-width="2" />
  <polygon points="745,760 750,770 755,760" fill="#0d47a1" />
  <text x="760" y="690" font-family="Arial, sans-serif" font-size="12" fill="#0d47a1">6. 调用硬件接口</text>
  
  <!-- HDI层 -> 传感器硬件 -->
  <line x1="750" y1="820" x2="750" y2="860" stroke="#0d47a1" stroke-width="2" />
  <polygon points="745,860 750,870 755,860" fill="#0d47a1" />
  <text x="760" y="840" font-family="Arial, sans-serif" font-size="12" fill="#0d47a1">7. 操作硬件</text>
  
  <!-- 传感器数据回传流程箭头 -->
  <!-- 传感器硬件 -> HDI层 -->
  <line x1="700" y1="860" x2="700" y2="820" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="695,820 700,810 705,820" fill="#b71c1c" />
  <text x="670" y="840" font-family="Arial, sans-serif" font-size="12" fill="#b71c1c">1. 数据产生</text>
  
  <!-- HDI层 -> SensorService -->
  <line x1="700" y1="760" x2="700" y2="620" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="695,620 700,610 705,620" fill="#b71c1c" />
  <text x="670" y="690" font-family="Arial, sans-serif" font-size="12" fill="#b71c1c">2. 数据上报</text>
  
  <!-- SensorService -> SensorClientProxy -->
  <line x1="750" y1="620" x2="750" y2="660" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="745,660 750,670 755,660" fill="#b71c1c" />
  <text x="760" y="640" font-family="Arial, sans-serif" font-size="12" fill="#b71c1c">3. 查找订阅客户端</text>
  
  <!-- SensorClientProxy -> SensorClientStub (IPC) -->
  <line x1="600" y1="690" x2="400" y2="690" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="400,685 390,690 400,695" fill="#b71c1c" />
  <text x="500" y="680" font-family="Arial, sans-serif" font-size="12" fill="#b71c1c">4. IPC回调</text>
  
  <!-- 数据通道传输 -->
  <path d="M 600 720 C 500 740, 500 740, 400 720" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" fill="none" />
  <polygon points="400,715 390,720 400,725" fill="#b71c1c" />
  <text x="500" y="730" font-family="Arial, sans-serif" font-size="12" fill="#b71c1c">5. 共享内存/Socket传输</text>
  
  <!-- SensorClientStub -> SensorDataChannel -->
  <line x1="250" y1="720" x2="250" y2="760" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="245,760 250,770 255,760" fill="#b71c1c" />
  <text x="260" y="740" font-family="Arial, sans-serif" font-size="12" fill="#b71c1c">6. 接收数据</text>
  
  <!-- SensorDataChannel -> SensorAgentProxy -->
  <path d="M 200 760 C 150 700, 150 320, 200 320" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" fill="none" />
  <polygon points="200,315 210,320 200,325" fill="#b71c1c" />
  <text x="130" y="540" font-family="Arial, sans-serif" font-size="12" fill="#b71c1c">7. 数据回调</text>
  
  <!-- SensorAgentProxy -> 应用程序 -->
  <line x1="250" y1="260" x2="250" y2="220" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="245,220 250,210 255,220" fill="#b71c1c" />
  <text x="260" y="240" font-family="Arial, sans-serif" font-size="12" text-anchor="end" fill="#b71c1c">8. 用户回调</text>
  
  <!-- 图例 -->
  <rect x="100" y="940" width="20" height="10" fill="none" stroke="#0d47a1" stroke-width="2" />
  <text x="130" y="948" font-family="Arial, sans-serif" font-size="12" fill="#333">客户端请求流程</text>
  
  <rect x="300" y="940" width="20" height="10" fill="none" stroke="#b71c1c" stroke-width="2" stroke-dasharray="5,3" />
  <text x="330" y="948" font-family="Arial, sans-serif" font-size="12" fill="#333">传感器数据回传流程</text>
  
  <rect x="500" y="940" width="20" height="10" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="530" y="948" font-family="Arial, sans-serif" font-size="12" fill="#333">客户端组件</text>
  
  <rect x="700" y="940" width="20" height="10" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="730" y="948" font-family="Arial, sans-serif" font-size="12" fill="#333">服务端组件</text>
</svg>
